etcd:
  name: "{HOSTNAME}"
  auto-compaction-retention: 1
  advertise_client_urls: "http://{PRIVATE_IPV4}:2379"
  data_dir: /tmp
  discovery: "${discovery_url}"
  listen_client_urls: "http://{PRIVATE_IPV4}:2379,http://localhost:2379"
  listen_peer_urls: "http://{PRIVATE_IPV4}:2380"
  initial_advertise_peer_urls: "http://{PRIVATE_IPV4}:2380"

systemd:
  units:
    - name: etcd-member.service
      dropins:
        - name: conf1.conf
          contents: |
            [Service]
            Environment=/run/metadata/coreos
            ExecStartPre=echo {PRIVATE_IPV4}

    - name: date.service
      contents: |
        [Unit]
        Description=Backup ETCD Data

        [Service]
        Type=oneshot
        ExecStart=/usr/bin/etcdctl

    - name: date.timer
      enable: true
      contents: |
        [Unit]
        Description=Run date.service every 10 minutes

        [Timer]
        OnCalendar=*:0/10

        [Install]
        WantedBy=multi-user.target
